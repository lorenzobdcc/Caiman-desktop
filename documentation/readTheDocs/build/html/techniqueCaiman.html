<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Recherche" href="search.html" /><link rel="next" title="Description technique: Interface graphique" href="techniqueInterface.html" /><link rel="prev" title="Description technique: API" href="techniqueAPI.html" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.beta34"/>
        <title>Description technique: Application Caiman - Documentation Caiman 1.1.0</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=59ab60ac09ea94ccfe6deddff6d715cce948a6fc">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Documentation Caiman 1.1.0</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Documentation Caiman 1.1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Recherche name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption"><span class="caption-text">table des matières</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="resume.html">Résumé</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html#abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html#remerciement">Remerciement</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html#legalite-du-projet">Légalité du projet</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html#installation-de-caiman-utilisateur">Installation de Caiman utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html#installation-de-caiman-serveur">Installation de Caiman serveur</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="cdc.html">Cahier des charges</a></li>
<li class="toctree-l1"><a class="reference internal" href="opportunite.html">Étude d’opportunité</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonctionnelleBDD.html">Analyse fonctionnelle</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonctionnelleWeb.html">Site web Caiman</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonctionnelleAPI.html">API Caiman</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonctionnelleC%23.html">Application  Caiman C#</a></li>
<li class="toctree-l1"><a class="reference internal" href="fonctionnelleInterface.html">Interface utilisateur utilisable à la manette</a></li>
<li class="toctree-l1"><a class="reference internal" href="debian.html">Serveur Debian 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Analyse organique</a></li>
<li class="toctree-l1"><a class="reference internal" href="techniqueWeb.html">Description technique: Site web</a></li>
<li class="toctree-l1"><a class="reference internal" href="techniqueAPI.html">Description technique: API</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Description technique: Application Caiman</a></li>
<li class="toctree-l1"><a class="reference internal" href="techniqueInterface.html">Description technique: Interface graphique</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="logbook.html">Logbook</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="description-technique-application-caiman">
<h1>Description technique: Application Caiman<a class="headerlink" href="#description-technique-application-caiman" title="Lien permanent vers ce titre">¶</a></h1>
<p>Diagramme de classe</p>
<p><img alt="alt_text" src="_images/DiagramLogique.png"/></p>
<div class="section" id="creation-de-dossier">
<h2>Création de dossier<a class="headerlink" href="#creation-de-dossier" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="structure-des-dossiers">
<h3>Structure des dossiers<a class="headerlink" href="#structure-des-dossiers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Caiman nécessite de créer certains dossiers et fichiers pour pouvoir fonctionner correctement. Ces dossiers se trouvent dans le dossier “%appdata%\Roaming\Caiman”</p>
<p><img alt="alt_text" src="_images/dossier_appdata_caiman.png"/></p>
<p><strong>Caiman</strong></p>
<p>Ce dossier contient les fichiers de configuration graphique, la liste des jeux téléchargés et le dernier CaimanToken reçu.</p>
<p><strong>img</strong></p>
<p>Ce dossier contient les différentes images des jeux, ces images sont téléchargées sur le site internet de caiman.</p>
<p><strong>users</strong></p>
<p>Ce dossier contient les dossiers personnels de chaque utilisateur de l’application qui s’est connecté sur le pc. Il possède les fichiers de sauvegarde de l’utilisateur en question.</p>
</div>
<div class="section" id="creation-des-dossiers">
<h3>Création des dossiers<a class="headerlink" href="#creation-des-dossiers" title="Lien permanent vers ce titre">¶</a></h3>
<p><strong>Dossier de base</strong></p>
<p>Les dossiers pour caiman doivent obligatoirement être créés. Donc au début du lancement de l’application Caiman, il y a toujours une vérification pour savoir si les dossiers sont bien présents. Si c’est le premier lancement de Caiman ou si les dossiers ont été supprimés, ils vont être créés.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">void</span> <span class="nf">CreateAppDataFolder</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">appDataPath</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">basePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">caimanConfigPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\Caiman\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">imgPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\img\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">gamesPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\Caiman\games.ini"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">configPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\Caiman\config.ini"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">loginPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\Caiman\login.ini"</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">basePath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">basePath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">imgPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">imgPath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">caimanConfigPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">caimanConfigPath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="s">@"C:\Caiman\Playstation2"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="s">@"C:\Caiman\Playstation2\"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="s">@"C:\Caiman\GamecubeWii\"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="s">@"C:\Caiman\GamecubeWii\"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">loginPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">sw</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">CreateText</span><span class="p">(</span><span class="n">loginPath</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"token = 0"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">loginFile</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigFileEditor</span><span class="p">(</span><span class="n">caimanConfigPath</span><span class="p">,</span> <span class="s">"login.ini"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">gamesPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">sw</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">CreateText</span><span class="p">(</span><span class="n">gamesPath</span><span class="p">))</span>
                <span class="p">{</span>

                <span class="p">}</span>
                <span class="n">configFile</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigFileEditor</span><span class="p">(</span><span class="n">caimanConfigPath</span><span class="p">,</span> <span class="s">"config.ini"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">configPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">//if the file do not exist create it with with the default emulators value</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">StreamWriter</span> <span class="n">sw</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">CreateText</span><span class="p">(</span><span class="n">configPath</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"configuration = 1080"</span><span class="p">);</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"fullscreen = true"</span><span class="p">);</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"definition = 3"</span><span class="p">);</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"formatSeizeNeuvieme = true"</span><span class="p">);</span>
                    <span class="n">sw</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"filtrageAnioscopique = 3"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">configFile</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConfigFileEditor</span><span class="p">(</span><span class="n">caimanConfigPath</span><span class="p">,</span> <span class="s">"config.ini"</span><span class="p">);</span>

            <span class="p">}</span>


        <span class="p">}</span>
</pre></div>
</div>
<p><strong>Dossier des utilisateurs</strong></p>
<p>La création des dossiers des utilisateurs pour gérer correctement les sauvegardes. Ces dossiers sont créés à la première connexion de l’utilisateur.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span> <span class="k">public</span> <span class="k">void</span> <span class="nf">CreateUserFolder</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">appDataPath</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">userPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\users\"</span> <span class="p">+</span> <span class="n">username</span> <span class="p">+</span> <span class="s">@"\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">savePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">userPath</span><span class="p">,</span> <span class="s">@"Save\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">savePathPlaystation</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">savePath</span><span class="p">,</span> <span class="s">@"Playstation2\"</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">savePathGamecubeWii</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">savePath</span><span class="p">,</span> <span class="s">@"GamecubeWii\"</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">userPath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">userPath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">savePath</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">savePath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">savePathPlaystation</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">savePathPlaystation</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">savePathGamecubeWii</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="p">(</span><span class="n">savePathGamecubeWii</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="verification-des-jeux-present-sur-le-disque">
<h2>Verification des jeux présent sur le disque<a class="headerlink" href="#verification-des-jeux-present-sur-le-disque" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour connaître les jeux qui ont été téléchargés, il existe un fichier comprenant les ids des jeux. Ce fichier se trouve dans le dossier “appdata” de Caiman. Il est donc commun à tous les utilisateurs. Ce fichier est mis à jour quand un utilisateur a fini de télécharger un jeu ou quand il décide d’en supprimer un.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">void</span> <span class="nf">CheckIfGameFileIsPresentOnDisk</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">lst_idGames</span> <span class="p">=</span> <span class="n">gamesListConfigFile</span><span class="p">.</span><span class="n">GetAllValueInList</span><span class="p">();</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">idGameString</span> <span class="k">in</span> <span class="n">lst_idGames</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">idGameString</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">idGame</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToInt32</span><span class="p">(</span><span class="n">idGameString</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="s">@"C:\Caiman\"</span> <span class="p">+</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFolderNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">)</span> <span class="p">+</span> <span class="s">@"\"</span> <span class="p">+</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFileNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">)))</span>
                    <span class="p">{</span>
                        <span class="n">gamesListConfigFile</span><span class="p">.</span><span class="n">DeleteValue</span><span class="p">(</span><span class="n">idGameString</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Si l’utilisateur décide de supprimer un fichier sans passer par caiman il pourrait y avoir un souci alors pour pallier à ce problème une vérification est faite. Au lancement de l’application, si un fichier est manquant, alors le fichier qui contient les id des jeux sera mis à jour.</p>
</div>
<div class="section" id="parametres-graphique">
<h2>Paramètres graphique<a class="headerlink" href="#parametres-graphique" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="liste-des-parametres-graphique">
<h3>Liste des paramètres graphique<a class="headerlink" href="#liste-des-parametres-graphique" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’utilisateur a la possibilité de modifier plusieurs paramètres:</p>
<p>La configuration global de l’émulateur</p>
<ul class="simple">
<li><p>Original</p></li>
<li><p>1080p</p></li>
<li><p>4K</p></li>
</ul>
<p>Si le jeu doit se lancer en mode plein écran</p>
<ul class="simple">
<li><p>true</p></li>
<li><p>false</p></li>
</ul>
<p>Si le jeu doit se lancer en 16/9</p>
<ul class="simple">
<li><p>true</p></li>
<li><p>false</p></li>
</ul>
<p>Les différents modes graphiques modifient ces paramètres:</p>
<ul class="simple">
<li><p>le filtrage anisotropique</p></li>
<li><p>l’upscale de la définition</p></li>
</ul>
<p>Le filtrage anisotropique permet entre autres de diminuer l’effet de crénelage, ainsi qu’à améliorer l’affichage des textures vue depuis un angle de vue extrême.</p>
<p>L’upscale de la définition permet d’augmenter la définition native du rendu. Par exemple, la définition de base de la Playstation 2 sur le jeu Kingdom Heart( 512x448). Cette définition est donc la définition que l’utilisateur va avoir en “Original”, mais s’il opte pour le paramètre 1080p, il va avoir une définition native de 1536x1344. En mode 4K le rendu sera en définition 4096x3584.</p>
</div>
<div class="section" id="fichiers-de-configuration-pcsx2">
<h3>Fichiers de configuration PCSX2<a class="headerlink" href="#fichiers-de-configuration-pcsx2" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour l’émulateur PCSX2, il y a deux fichiers de configuration qui doivent être modifiés.</p>
<p>Les fichiers se trouvent dans le dossier “PCSX2\inis\”.</p>
<p>Le fichier “GSDX.ini” permet de modifier les paramètres de d’upscale et de filtrage anisotropique.</p>
<p>Le fichier “PCSX2_ui.ini” permet de modifier l’affichage en plein écran et le format d’affichage.</p>
<p>Le paramètre de format d’écran dans le fichier de configuration de PCSX n’est pas un booléen mais du texte je dois avant l’écriture dans le fichier le convertir.</p>
<p>Pareil pour le paramètre de mode plein écran</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">UpdateConfigurationFile</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">configFileGSdx</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"upscale_multiplier"</span><span class="p">,</span> <span class="n">definition</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
            <span class="n">configFileGSdx</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"MaxAnisotropy"</span><span class="p">,</span> <span class="n">filtrageAnioscopique</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>

            <span class="c1">// the format is not true or false so i have to format it</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fullScreen</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">configFilePCSX2_ui</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"DefaultToFullscreen"</span><span class="p">,</span> <span class="s">"enabled"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">configFilePCSX2_ui</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"DefaultToFullscreen"</span><span class="p">,</span> <span class="s">"disabled"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// the format is not true or false so i have to format it </span>
            <span class="k">if</span> <span class="p">(</span><span class="n">formatSeizeNeuvieme</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">configFilePCSX2_ui</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"AspectRatio"</span><span class="p">,</span> <span class="s">"16:9"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">configFilePCSX2_ui</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"AspectRatio"</span><span class="p">,</span> <span class="s">"4:3"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="fichiers-de-configuration-dolphin">
<h3>Fichiers de configuration Dolphin<a class="headerlink" href="#fichiers-de-configuration-dolphin" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour l’émulateur Dolphin, il y a deux fichiers de configuration qui doivent être modifiés.</p>
<p>Les fichiers se trouvent dans le dossier “Dolphin\User\Config\”.</p>
<p>Le fichier “GFX.ini” permet de modifier les paramètres de d’upscale et de filtrage anisotropique.</p>
<p>Le fichier “Dolphin.ini” permet de modifier l’affichage en plein écran et le format d’affichage.</p>
<p>Le paramètre de format d’écran dans le fichier de configuration de Dolphin n’est pas un booléen mais un nombre. Donc avant l’écriture dans le fichier je dois le convertir.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">UpdateConfigurationFile</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">configFileDolphin</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"Fullscreen"</span><span class="p">,</span> <span class="n">fullScreen</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
            <span class="n">configFileGFX</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"InternalResolution"</span><span class="p">,</span> <span class="n">definition</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
            <span class="n">configFileGFX</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"MaxAnisotropy"</span><span class="p">,</span> <span class="n">filtrageAnioscopique</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">formatSeizeNeuvieme</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">configFileGFX</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"AspectRatio"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">configFileGFX</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"AspectRatio"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">);</span>
            <span class="p">}</span>
            
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="sauvegarde-des-parametres-graphique">
<h3>Sauvegarde des paramètres graphique<a class="headerlink" href="#sauvegarde-des-parametres-graphique" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les paramètres graphiques définis par l’utilisateur se trouvent dans le dossier “appdata\Caiman\Caiman\config.ini”.</p>
<p>Les paramètres sont mis à jour grâce à la classe ConfigFileEditor, cette classe permet la manipulation de fichier “.ini” que ce soit la lecture,la modification, la suppression, la création de propriétés.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">ApplyGlobalConfiguration</span><span class="p">(</span><span class="kt">string</span> <span class="n">configuration</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">configuration</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="s">"original"</span><span class="p">:</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"definition"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"filtrageAnioscopique"</span><span class="p">,</span> <span class="s">"1"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"configuration"</span><span class="p">,</span> <span class="s">"original"</span><span class="p">);</span>
                    <span class="n">ScanConfiguration</span><span class="p">();</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s">"1080"</span><span class="p">:</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"definition"</span><span class="p">,</span> <span class="s">"3"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"filtrageAnioscopique"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"configuration"</span><span class="p">,</span> <span class="s">"1080p"</span><span class="p">);</span>
                    <span class="n">ScanConfiguration</span><span class="p">();</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="s">"4K"</span><span class="p">:</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"definition"</span><span class="p">,</span> <span class="s">"8"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"filtrageAnioscopique"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">);</span>
                    <span class="n">configFile</span><span class="p">.</span><span class="n">UpdateProperties</span><span class="p">(</span><span class="s">"configuration"</span><span class="p">,</span> <span class="s">"4K"</span><span class="p">);</span>
                    <span class="n">ScanConfiguration</span><span class="p">();</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="telechargement-dimages">
<h2>Téléchargement d’images<a class="headerlink" href="#telechargement-dimages" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le téléchargement des images se fait à la création d’un objet de type Game. Le téléchargement se fait à partir du site web de Caiman “caiman.cfpt.info”. Les fichiers sont téléchargés dans le dossier appdata. L’intérêt de stocker les images dans ce dossier est de créer un système de cache qui sera accessible à tous les utilisateurs.  <br/>
<br/>
Le téléchargement se fait grâce à un WebClient. Avant tout téléchargement de fichier, Caiman vérifie si le fichier n’est pas déjà existant, ce qui permet d’éviter de télécharger plusieurs fois la même image.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">void</span> <span class="nf">DownloadImage</span><span class="p">()</span>
        <span class="p">{</span>

            <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">imgPath</span> <span class="p">+</span> <span class="n">imageName</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">WebClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">client</span><span class="p">.</span><span class="n">DownloadFile</span><span class="p">(</span><span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="n">URL_IMAGES_CAIMAN</span> <span class="p">+</span> <span class="n">imageName</span><span class="p">),</span> <span class="p">(</span><span class="n">imgPath</span> <span class="p">+</span> <span class="n">imageName</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="execution-de-jeu">
<h2>Exécution de jeu<a class="headerlink" href="#execution-de-jeu" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="choix-du-jeu-a-lancer">
<h3>Choix du jeu à lancer<a class="headerlink" href="#choix-du-jeu-a-lancer" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le choix du jeu se fait à partir de la page de visualisation des détails d’un jeu. Quand l’utilisateur clique sur le bouton “Play” l’id du jeu qui doit être exécuté est envoyé à la fonction EmulatorManager.StartGame(idGame).</p>
<p>La fonction va ensuite faire un appel à l’API pour connaître de quelle console est le jeu qui doit être exécuté et selon la console un émulateur différent sera utilisé.</p>
</div>
<div class="section" id="emulateur-embarque-avec-caiman">
<h3>Emulateur embarqué avec Caiman<a class="headerlink" href="#emulateur-embarque-avec-caiman" title="Lien permanent vers ce titre">¶</a></h3>
<p>Caiman embarque deux émulateurs PCSX2 et Dolphin ces émulateurs servent respectivement à l’exécution de jeux de Playstation 2 et de Gamecube/Wii. L’exécution n’est pas la même selon l’émulateur, alors je vais détailler pour chacun. Avant l’exécution d’un jeu, l’application des paramètres graphiques est faite mais je ne vais pas le détailler ici.</p>
</div>
<div class="section" id="execution-avec-pcsx2">
<h3>Exécution avec PCSX2<a class="headerlink" href="#execution-avec-pcsx2" title="Lien permanent vers ce titre">¶</a></h3>
<p>En premier lieu, je vais recréer le chemin qui mène au fichier qui doit être exécuté par exemple “C:\Caiman\Playstation2\DRAGON_QUEST_VIII.iso”. Par la suite, je vais créer une variable pour les différents paramètres, dans la version de caiman actuel on ne peut pas changer ces paramètres se sera donc toujours “ –nogui –portable”.</p>
<p>Le premier paramètre fait en sorte que l’émulateur n’affiche pas d’interface graphique, seule la fenêtre d’exécution du jeu est visible. Le deuxième paramètre sert à dire à PCSX2 que les fichiers de configurations qui doivent être utilisés sont ceux du dossier de l’émulateur, et non ceux du dossier créé pour chaque utilisateur windows par PCSX2.</p>
<p>Pour lancer l’exécution, je vais lancer le processus de PCSX2.exe avec en premier paramètre le chemin de l’iso à exécuter et après les paramètres cités précédemment.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">idGame</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">@"C:\Caiman\"</span> <span class="p">+</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFolderNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">)</span> <span class="p">+</span> <span class="s">@"\"</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">filename</span> <span class="p">=</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFileNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">);</span>
            <span class="n">UpdateConfigurationFile</span><span class="p">();</span>
            <span class="kt">int</span> <span class="n">process</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="n">GetProcessesByName</span><span class="p">(</span><span class="n">PROCESS_NAME</span><span class="p">).</span><span class="n">Length</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">process</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//param pour ne pas afficher l'interface graphique --portable --nogui</span>
                <span class="kt">string</span> <span class="n">param</span> <span class="p">=</span> <span class="s">" --nogui --portable"</span><span class="p">;</span>

                <span class="n">processEmulator</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">PCSX2Folder</span> <span class="p">+</span> <span class="n">EXE_NAME</span><span class="p">,</span> <span class="n">path</span> <span class="p">+</span> <span class="n">filename</span> <span class="p">+</span> <span class="n">param</span><span class="p">);</span>

            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Close</span><span class="p">();</span>
                <span class="n">Execute</span><span class="p">(</span><span class="n">idGame</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="execution-avec-dolphin">
<h3>Exécution avec Dolphin<a class="headerlink" href="#execution-avec-dolphin" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ensuite, je vais recréer le chemin qui mène au fichier qui doit être exécuté par exemple “C:\Caiman\GamecubeWii\METROID_PRIME.iso”. Je vais également créer une variable pour les différents paramètres, dans la version de caiman actuel on ne peut pas changer ces paramètres, il sera toujours “ –batch”.</p>
<p>Le paramètre “–batch” fait en sorte de ne pas afficher l’interface de Dolphin, et donc d’avoir seulement la fenêtre d’exécution du jeu.</p>
<p>Pour lancer l’exécution, je vais lancer le processus de PCSX2.exe avec en premier paramètre le chemin de l’iso a exécuter et après le paramètre cité précédemment.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">idGame</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">@"C:\Caiman\"</span> <span class="p">+</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFolderNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">)</span> <span class="p">+</span> <span class="s">@"\"</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">filename</span> <span class="p">=</span> <span class="n">callAPI</span><span class="p">.</span><span class="n">CallFileNameGame</span><span class="p">(</span><span class="n">idGame</span><span class="p">);</span>
            
            <span class="n">UpdateConfigurationFile</span><span class="p">();</span>
            <span class="kt">int</span> <span class="n">process</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="n">GetProcessesByName</span><span class="p">(</span><span class="n">PROCESS_NAME</span><span class="p">).</span><span class="n">Length</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">process</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//param pour ne pas mettre de gui et en fullscreen --portable</span>
                <span class="kt">string</span> <span class="n">param</span> <span class="p">=</span> <span class="s">" --batch"</span><span class="p">;</span>

                <span class="n">processEmulator</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">dolphinFolder</span> <span class="p">+</span> <span class="n">EXE_NAME</span><span class="p">,</span> <span class="n">param</span> <span class="p">+</span> <span class="s">" --exec \""</span> <span class="p">+</span> <span class="n">path</span> <span class="p">+</span> <span class="n">filename</span><span class="p">);</span>

            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Close</span><span class="p">();</span>
                <span class="n">Execute</span><span class="p">(</span><span class="n">idGame</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="information-complementaire">
<h3>Information complémentaire<a class="headerlink" href="#information-complementaire" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il n’est pas possible de lancer un jeu alors qu” un autre est toujours en cours.</p>
</div>
</div>
<div class="section" id="affichage-et-calcul-du-temps-de-jeu">
<h2>Affichage et calcul du temps de jeu<a class="headerlink" href="#affichage-et-calcul-du-temps-de-jeu" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le temps de jeu est comptabilisé dans la base de données à la minute près.</p>
<div class="section" id="affichage-dans-le-detail-dun-jeu">
<h3>Affichage dans le détail d’un jeu<a class="headerlink" href="#affichage-dans-le-detail-dun-jeu" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand un utilisateur de Caiman se rend sur la page de détails d’un jeu, il verra son nombre d’heures et de minutes de jeu. Pour récupérer cette information, je fais un appel à la base de données .CallTimeInGameUser(idGame,idUser) cette appel va me rendre un objet TimeInGame qui va permettre de formater la réponse de l’API et afficher les heures et le minutes sous le format “10h10”. Si l’utilisateur n’a pas jouer au jeu, il verra afficher “Time played: 00h00”.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="kt">string</span> <span class="n">TimeHoursMinutes</span>
        <span class="p">{</span>
            <span class="k">get</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">time</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">hours</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">minutes</span> <span class="p">/</span> <span class="m">60</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">minutesInt</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">minutes</span> <span class="p">%</span> <span class="m">60</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">minutesInt</span> <span class="p">==</span> <span class="m">60</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">hours</span><span class="p">++;</span>
                    <span class="n">minutesInt</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="kt">string</span> <span class="n">minutesString</span> <span class="p">=</span> <span class="n">minutesInt</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
                <span class="kt">string</span> <span class="n">hoursString</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">minutesInt</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">minutesString</span> <span class="p">=</span> <span class="s">"0"</span> <span class="p">+</span> <span class="n">minutesInt</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hours</span> <span class="p">&lt;</span> <span class="m">10</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">hoursString</span> <span class="p">=</span> <span class="s">"0"</span> <span class="p">+</span> <span class="n">hours</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">time</span> <span class="p">=</span> <span class="n">hoursString</span> <span class="p">+</span> <span class="s">" h "</span> <span class="p">+</span> <span class="n">minutesString</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="affichage-du-temps-de-jeu-actuel">
<h3>Affichage du temps de jeu actuel<a class="headerlink" href="#affichage-du-temps-de-jeu-actuel" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand un utilisateur lance un jeu, un objet GameTimer va être créé, cet objet sert à compter le temps de jeu de la session actuelle et à mettre à jour la base de données.</p>
<p>La classe GameTimer va initialiser in timer pour rafraîchir l’affichage de la navbar avec la valeur adéquate. Ce timer se rafraîchit toutes les secondes. Celui-ci va également appeler la fonction UpdateTimer, UpdateTimer va incrémenter le nombre de secondes de jeu et toutes les 60 secondes, il va faire un appel à l’API pour incrémenter le temps de jeu de l’utilisateur dans la base de données. L’incrémentation se fait donc toutes les minutes, cela permet d’être assez précis dans le décompte de temps de jeu.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">InitTimer</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">timer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="p">();</span>
            <span class="n">timer</span><span class="p">.</span><span class="n">Tick</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">(</span><span class="n">UpdateTimer</span><span class="p">);</span>

            <span class="n">timer</span><span class="p">.</span><span class="n">Interval</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
            <span class="n">timer</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
        <span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">UpdateTimer</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">counter</span><span class="p">++;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="p">==</span> <span class="m">60</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">minutes</span><span class="p">++;</span>
                <span class="n">counter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

                <span class="n">callAPI</span><span class="p">.</span><span class="n">AddOneMinuteToGame</span><span class="p">(</span><span class="n">game</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>
</pre></div>
</div>
<p>L’affichage de temps de jeu se fait dans la navbar en haut à gauche, Les informations affichées sont les suivantes:</p>
<ul class="simple">
<li><p>Nom du jeu en cours</p></li>
<li><p>heures et minutes de jeu de la session actuel sous le format 10m50</p></li>
</ul>
</div>
</div>
<div class="section" id="telechargement-de-jeux">
<h2>Téléchargement de jeux<a class="headerlink" href="#telechargement-de-jeux" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="type-de-fichiers">
<h3>Type de fichiers<a class="headerlink" href="#type-de-fichiers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les fichiers utilisés par les émulateurs sont des fichiers .iso, que ce soit par PCSX2 ou Dolphin.</p>
</div>
<div class="section" id="choix-du-fichier-a-telecharger">
<h3>Choix du fichier à télécharger<a class="headerlink" href="#choix-du-fichier-a-telecharger" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le fichier à télécharger se fait sur la page de détails d’un jeu, si le jeu n’a pas déjà été téléchargé. Un bouton “download” sera présent, ce bouton va envoyer l’id du jeu qui doit être télécharger.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">gamePath</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">XboxButton</span> <span class="n">btn_download</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XboxButton</span><span class="p">(</span><span class="s">"download"</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                    <span class="n">btn_download</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"Download: "</span> <span class="p">+</span> <span class="n">game</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
                    <span class="n">btn_download</span><span class="p">.</span><span class="n">Location</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Point</span><span class="p">(</span><span class="m">500</span><span class="p">,</span> <span class="m">650</span><span class="p">);</span>
                    <span class="n">btn_download</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">EventHandler</span><span class="p">(</span><span class="n">bouton_Click</span><span class="p">);</span>
                    <span class="n">lstControls</span><span class="p">[</span><span class="n">rowCounter</span><span class="p">].</span><span class="n">Add</span><span class="p">(</span><span class="n">btn_download</span><span class="p">);</span>
                    <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn_download</span><span class="p">);</span>
                    <span class="n">rowCounter</span><span class="p">++;</span>
                    <span class="n">lstControls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Control</span><span class="p">&gt;());</span>
                <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ajout-dun-jeu-a-la-liste-de-telechargement">
<h3>Ajout d’un jeu à la liste de téléchargement<a class="headerlink" href="#ajout-dun-jeu-a-la-liste-de-telechargement" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les téléchargement des jeux sont gérés par la classe “DownloadManager”, cette classe contient 3 listes de téléchargement différentes:</p>
<ul class="simple">
<li><p>lst_download</p></li>
<li><p>lst_activeDownload</p></li>
<li><p>lst_finishDownload</p></li>
</ul>
<p>La première contient les téléchargement en attente, la deuxième le téléchargement en cours et la troisième la liste des téléchargements terminés.</p>
<p>Quand un téléchargement est créé, il est automatiquement ajouté à la liste de téléchargement en attente.</p>
</div>
<div class="section" id="lancement-dun-telechargement">
<h3>Lancement d’un téléchargement<a class="headerlink" href="#lancement-dun-telechargement" title="Lien permanent vers ce titre">¶</a></h3>
<p>À l’ajout d’un téléchargement, la fonction StartDownload() est appelée. Cette fonction vérifie si dans la liste de téléchargement il sera lancé. Si aucun téléchargement n’est en cours, la fonction NextDownload() va être lancée.</p>
<p>La fonction NextDownload() sert à savoir si un téléchargement est en cours,Si un téléchargement est en cours, il sera déplacé dans la liste des téléchargements finis, si aucun téléchargement n’est en cours le premier téléchargement de la liste en attente est lancé</p>
</div>
<div class="section" id="telechargement-dun-fichier">
<h3>Téléchargement d’un fichier<a class="headerlink" href="#telechargement-dun-fichier" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand la fonction download.StartDownload() est lancée, le WebClient se lance également. Ce WebClient télécharge le fichier en appelant l’API de caiman en passant en paramètres l’id du jeu qui doit être télécharger et l’apiKey de l’utilisateur.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">StartDownload</span><span class="p">()</span>
        <span class="p">{</span>
            
            <span class="k">if</span> <span class="p">(!</span><span class="n">CheckIfFileIsPresent</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">webClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="p">();</span>
                <span class="n">Uri</span> <span class="n">uri</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="n">URL_TO_GAMES</span> <span class="p">+</span> <span class="s">"?idGame="</span><span class="p">+</span><span class="n">idGame</span><span class="p">+</span><span class="s">"&amp;apiKey="</span><span class="p">+</span><span class="n">apiKey</span><span class="p">);</span>
                <span class="n">webClient</span><span class="p">.</span><span class="n">DownloadProgressChanged</span> <span class="p">+=</span> <span class="n">wc_DownloadProgressChanged</span><span class="p">;</span>
                <span class="n">webClient</span><span class="p">.</span><span class="n">DownloadFileAsync</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span><span class="n">pathToFolder</span><span class="p">+</span><span class="s">"temp."</span><span class="p">+</span><span class="n">filename</span><span class="p">);</span>
                <span class="n">active</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Le fichier sera téléchargé dans le dossier spécifique à l’émulateur, par exemple si un jeu pour l’émulateur PCSX2 est téléchargé alors le jeu sera télécharger dans le dossier</p>
<p>“C:\Caiman\Playstation2”. Par contre, le fichier n’est pas téléchargé avec le nom final, le préfix “temp.” est ajouté.Le préfixe est ajouté pour éviter que si un utilisateur quitte Caiman pendant un téléchargement, il ne se retrouve pas avec un fichier incomplet au prochain lancement de l’application.</p>
<p>A la fin du téléchargement d’un fichier, la fonction DownloadManager.NextDownload() est appelée. l’id du jeu est ajouté à la liste des jeux téléchargés, et le fichier est renommé avec le nom correct.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">NextDownload</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lst_activeDownload</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span><span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">lst_finishDownload</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lst_activeDownload</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                <span class="n">lst_activeDownload</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">lst_download</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">lst_activeDownload</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lst_download</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                <span class="n">lst_download</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
                <span class="n">StartDownload</span><span class="p">();</span>
            <span class="p">}</span>
            
            
        <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="synchronisation-des-sauvegardes">
<h2>Synchronisation des sauvegardes<a class="headerlink" href="#synchronisation-des-sauvegardes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="structure-des-sauvegardes">
<h3>Structure des sauvegardes<a class="headerlink" href="#structure-des-sauvegardes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les fichiers de sauvegardes des émulateurs sont faits ainsi:</p>
<p>PCSX2:</p>
<p>Les fichiers de sauvegardes pour PCSX2 sont 2 fichiers de 8MB, comme  les memory cards étaient à l’époque de la Playstation 2. Ces deux fichiers contiennent les différentes sauvegardes des jeux.</p>
<p><img alt="alt_text" src="_images/dossier_memcards.png"/></p>
<p>Dolphin:</p>
<p>Les fichiers de sauvegardes de l’émulateur Dolphin ne concernent qu’un seul jeu à la fois.</p>
<p><img alt="alt_text" src="_images/dossier_card_a.png"/></p>
<p>La solution pour structurer les sauvegardes des différents utilisateurs est celle-ci:</p>
<p>Chaque utilisateur possède un dossier personnel dans le dossier appdata de Caiman. Ce dossier contient le fichier de configuration graphique de l’application et un dossier ou ces sauvegardes sont présentes.</p>
<p>Le dossier de l’utilisateur lorenzo1227:</p>
<p><img alt="alt_text" src="_images/dossier_lorenzo1227.png"/></p>
<p>Le dossier contenant les sauvegardes de l’utilisateur lorenzo1227:</p>
<p><img alt="alt_text" src="_images/save_lorenzo1227.png"/></p>
</div>
<div class="section" id="upload-des-sauvegardes">
<h3>Upload des sauvegardes<a class="headerlink" href="#upload-des-sauvegardes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour pouvoir synchroniser les sauvegardes entre les différents PCs d’un utilisateur, j’ai commencé par savoir si l’un des fichiers présents dans les dossiers des différents émulateurs a été mis à jour. Pour ce faire, j’ai un timer qui va faire une vérification sur la dernière date de modification du fichier. S’il s’avère qu’une modification a été faite dans l’un des dossiers de sauvegardes, je copie l’intégralité du dossier de l’émulateur vers le dossier appdata de l’utilisateur.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">private</span> <span class="k">void</span> <span class="nf">ScanDateFile</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">counter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="n">lst_saveTimeOld</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
            <span class="n">lst_saveTimeOld</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">lst_saveTimeNow</span><span class="p">);</span>
            <span class="n">lst_saveTimeNow</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
            <span class="c1">//if a file has been added or delete sync the folder</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">initialCounterFile</span> <span class="p">!=</span> <span class="n">CountFileInFolder</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">isLocalFile</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">initialCounterFile</span> <span class="p">=</span> <span class="n">CountFileInFolder</span><span class="p">();</span>
                    <span class="n">MoveAllFileToUserFolder</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="n">FileInfo</span> <span class="n">save</span> <span class="k">in</span> <span class="n">lst_save</span><span class="p">)</span>
            <span class="p">{</span>

                <span class="n">save</span><span class="p">.</span><span class="n">Refresh</span><span class="p">();</span>

                <span class="n">lst_saveTimeNow</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">save</span><span class="p">.</span><span class="n">LastWriteTime</span><span class="p">.</span><span class="n">Ticks</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lst_saveTimeOld</span><span class="p">.</span><span class="n">Count</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">try</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">lst_saveTimeOld</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="p">!=</span> <span class="n">lst_saveTimeNow</span><span class="p">[</span><span class="n">counter</span><span class="p">])</span>
                        <span class="p">{</span>
                            <span class="c1">//if the file has benn modified since the last time move or sync the folder</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">lst_saveTimeOld</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="p">!=</span> <span class="s">""</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">isLocalFile</span><span class="p">)</span>
                                <span class="p">{</span>
                                    <span class="n">MoveFileToUserFolder</span><span class="p">(</span><span class="n">save</span><span class="p">);</span>
                                <span class="p">}</span>
                                <span class="k">else</span>
                                <span class="p">{</span>
                                    <span class="n">UploadSave</span><span class="p">();</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                        <span class="p">}</span>
                        <span class="n">counter</span><span class="p">++;</span>
                    <span class="p">}</span>
                    <span class="k">catch</span> <span class="p">{</span> <span class="p">}</span>
                <span class="p">}</span>


            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">MoveAllFileToUserFolder</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">DirectoryInfo</span> <span class="n">d</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DirectoryInfo</span><span class="p">(</span><span class="n">savePath</span><span class="p">);</span>
            <span class="n">FileInfo</span><span class="p">[]</span> <span class="n">Files</span> <span class="p">=</span> <span class="n">d</span><span class="p">.</span><span class="n">GetFiles</span><span class="p">();</span> 
            <span class="k">foreach</span> <span class="p">(</span><span class="n">FileInfo</span> <span class="n">file</span> <span class="k">in</span> <span class="n">Files</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">try</span>
                <span class="p">{</span>

                    <span class="n">File</span><span class="p">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">destinationPath</span><span class="p">,</span> <span class="n">file</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span> <span class="k">true</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
                <span class="p">{</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Si je trouve une différence alors cela veut dire que le fichier a été modifié. Quand un fichier a été modifié je crée une copie de ce fichier dans le dossier “username/save/nom_de_emulateur/”.</p>
<p>Quand un fichier a été mis à jour, supprimé ou créé dans le dossier de sauvegarde de l’utilisateur, je zip les fichiers présents dans le dossier pour les envoyer sur le serveur de Caiman.</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">void</span> <span class="nf">UploadSave</span><span class="p">()</span>
        <span class="p">{</span>

            <span class="kt">var</span> <span class="n">appDataPath</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">savePathZipDolpin</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">savePathZipPCSX2</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">savePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\users\"</span> <span class="p">+</span> <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">username</span> <span class="p">+</span> <span class="s">@"\Save\"</span><span class="p">);</span>

            <span class="n">savePathZipDolpin</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\users\"</span> <span class="p">+</span>  <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">username</span><span class="p">+</span> <span class="s">@"\Save\GamecubeWii\"</span><span class="p">);</span>
            <span class="n">savePathZipPCSX2</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\users\"</span> <span class="p">+</span> <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">username</span> <span class="p">+</span> <span class="s">@"\Save\Playstation2\"</span><span class="p">);</span>
            <span class="c1">//zip the save of the emulators</span>
            <span class="n">ZipFile</span><span class="p">.</span><span class="n">CreateFromDirectory</span><span class="p">(</span><span class="n">savePathZipPCSX2</span><span class="p">,</span> <span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempPCSX2.zip"</span><span class="p">);</span>
            <span class="n">ZipFile</span><span class="p">.</span><span class="n">CreateFromDirectory</span><span class="p">(</span><span class="n">savePathZipDolpin</span><span class="p">,</span> <span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempDolphin.zip"</span><span class="p">);</span>
            <span class="c1">//call the api to create a copy of the save to the Bunker</span>
            <span class="n">callAPI</span><span class="p">.</span><span class="n">UploadSave</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">apitoken</span><span class="p">,</span> <span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempDolphin.zip"</span><span class="p">);</span>
            <span class="n">callAPI</span><span class="p">.</span><span class="n">UploadSave</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="n">emulatorsManager</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">apitoken</span><span class="p">,</span> <span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempPCSX2.zip"</span><span class="p">);</span>
            <span class="c1">//delete the temporary zip file</span>
            <span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempPCSX2.zip"</span><span class="p">);</span>
            <span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">savePath</span> <span class="p">+</span> <span class="s">"tempDolphin.zip"</span><span class="p">);</span>
            
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="download-des-sauvegardes-presente-sur-le-serveur-de-caiman">
<h3>Download des sauvegardes présente sur le serveur de Caiman<a class="headerlink" href="#download-des-sauvegardes-presente-sur-le-serveur-de-caiman" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le lancement du téléchargement des sauvegardes est lancé à la connexion de l’utilisateur. Un appel à l’API est fait pour les deux émulateurs:</p>
<div class="highlight-C# notranslate"><div class="highlight"><pre><span></span> <span class="k">public</span> <span class="k">void</span> <span class="nf">CreateDownload</span><span class="p">(</span><span class="kt">int</span> <span class="n">idEmulator</span><span class="p">,</span> <span class="kt">string</span> <span class="n">apiKey</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="kt">var</span> <span class="n">appDataPath</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">savePath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">appDataPath</span><span class="p">,</span> <span class="s">@"Caiman\users\"</span> <span class="p">+</span> <span class="n">user</span><span class="p">.</span><span class="n">username</span> <span class="p">+</span> <span class="s">@"\Save\"</span><span class="p">);</span>


            <span class="k">if</span> <span class="p">(</span><span class="n">lst_download</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">lst_download</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">DownloadSave</span><span class="p">&gt;();</span>
            <span class="p">}</span>
            <span class="n">lst_download</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">DownloadSave</span><span class="p">(</span><span class="n">savePath</span><span class="p">,</span> <span class="n">idEmulator</span><span class="p">,</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">apiKey</span><span class="p">,</span><span class="n">user</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Ces appels à l’API vont télécharger des fichiers .zip contenant les sauvegardes des différents émulateurs. Ces deux fichiers vont être décompressé dans le dossier spécifique de chaque émulateur. Avant de pouvoir décompresser le dossier, je dois au préalable supprimer le contenu des dossiers de destination (Si je dois supprimer le contenu des dossiers c’est parce que la classe Zipfile de C# sous la version 5.0 ne peut pas “override” le contenu d’un dossier).</p>
<p>Quand les fichiers zip sont décompressés le contenu est envoyé dans les dossiers des différents émulateurs.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="techniqueInterface.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Description technique: Interface graphique</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="techniqueAPI.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Description technique: API</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Lorenzo Bauduccio
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/techniqueCaiman.md.txt"
               rel="nofollow">
              Montrer le code source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contenu
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Description technique: Application Caiman</a><ul>
<li><a class="reference internal" href="#creation-de-dossier">Création de dossier</a><ul>
<li><a class="reference internal" href="#structure-des-dossiers">Structure des dossiers</a></li>
<li><a class="reference internal" href="#creation-des-dossiers">Création des dossiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verification-des-jeux-present-sur-le-disque">Verification des jeux présent sur le disque</a></li>
<li><a class="reference internal" href="#parametres-graphique">Paramètres graphique</a><ul>
<li><a class="reference internal" href="#liste-des-parametres-graphique">Liste des paramètres graphique</a></li>
<li><a class="reference internal" href="#fichiers-de-configuration-pcsx2">Fichiers de configuration PCSX2</a></li>
<li><a class="reference internal" href="#fichiers-de-configuration-dolphin">Fichiers de configuration Dolphin</a></li>
<li><a class="reference internal" href="#sauvegarde-des-parametres-graphique">Sauvegarde des paramètres graphique</a></li>
</ul>
</li>
<li><a class="reference internal" href="#telechargement-dimages">Téléchargement d’images</a></li>
<li><a class="reference internal" href="#execution-de-jeu">Exécution de jeu</a><ul>
<li><a class="reference internal" href="#choix-du-jeu-a-lancer">Choix du jeu à lancer</a></li>
<li><a class="reference internal" href="#emulateur-embarque-avec-caiman">Emulateur embarqué avec Caiman</a></li>
<li><a class="reference internal" href="#execution-avec-pcsx2">Exécution avec PCSX2</a></li>
<li><a class="reference internal" href="#execution-avec-dolphin">Exécution avec Dolphin</a></li>
<li><a class="reference internal" href="#information-complementaire">Information complémentaire</a></li>
</ul>
</li>
<li><a class="reference internal" href="#affichage-et-calcul-du-temps-de-jeu">Affichage et calcul du temps de jeu</a><ul>
<li><a class="reference internal" href="#affichage-dans-le-detail-dun-jeu">Affichage dans le détail d’un jeu</a></li>
<li><a class="reference internal" href="#affichage-du-temps-de-jeu-actuel">Affichage du temps de jeu actuel</a></li>
</ul>
</li>
<li><a class="reference internal" href="#telechargement-de-jeux">Téléchargement de jeux</a><ul>
<li><a class="reference internal" href="#type-de-fichiers">Type de fichiers</a></li>
<li><a class="reference internal" href="#choix-du-fichier-a-telecharger">Choix du fichier à télécharger</a></li>
<li><a class="reference internal" href="#ajout-dun-jeu-a-la-liste-de-telechargement">Ajout d’un jeu à la liste de téléchargement</a></li>
<li><a class="reference internal" href="#lancement-dun-telechargement">Lancement d’un téléchargement</a></li>
<li><a class="reference internal" href="#telechargement-dun-fichier">Téléchargement d’un fichier</a></li>
</ul>
</li>
<li><a class="reference internal" href="#synchronisation-des-sauvegardes">Synchronisation des sauvegardes</a><ul>
<li><a class="reference internal" href="#structure-des-sauvegardes">Structure des sauvegardes</a></li>
<li><a class="reference internal" href="#upload-des-sauvegardes">Upload des sauvegardes</a></li>
<li><a class="reference internal" href="#download-des-sauvegardes-presente-sur-le-serveur-de-caiman">Download des sauvegardes présente sur le serveur de Caiman</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>